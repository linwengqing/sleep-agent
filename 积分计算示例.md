# 睡眠积分计算示例

## 积分计算规则

### 基础分规则
- 睡眠总分 ≥ 80分 → 20 SP
- 睡眠总分 70-79分 → 15 SP  
- 睡眠总分 60-69分 → 10 SP
- 睡眠总分 < 60分 → 5 SP

### 额外分规则
- 深睡时长每满30分钟 → +5 SP
- 额外分最多加30 SP

### 每日上限
- 每日最高可获得50 SP

## 计算示例

### 示例1：高分睡眠
- **睡眠评分**: 85分
- **深睡时长**: 120分钟
- **计算过程**:
  - 基础分: 85分 ≥ 80分 → 20 SP
  - 额外分: 120分钟 ÷ 30分钟 = 4个30分钟 → 4 × 5 = 20 SP
  - 总积分: 20 + 20 = 40 SP
- **最终积分**: 40 SP

### 示例2：中等分数睡眠
- **睡眠评分**: 75分
- **深睡时长**: 90分钟
- **计算过程**:
  - 基础分: 75分在70-79分区间 → 15 SP
  - 额外分: 90分钟 ÷ 30分钟 = 3个30分钟 → 3 × 5 = 15 SP
  - 总积分: 15 + 15 = 30 SP
- **最终积分**: 30 SP

### 示例3：低分睡眠
- **睡眠评分**: 55分
- **深睡时长**: 60分钟
- **计算过程**:
  - 基础分: 55分 < 60分 → 5 SP
  - 额外分: 60分钟 ÷ 30分钟 = 2个30分钟 → 2 × 5 = 10 SP
  - 总积分: 5 + 10 = 15 SP
- **最终积分**: 15 SP

### 示例4：深睡时长上限
- **睡眠评分**: 90分
- **深睡时长**: 300分钟（5小时）
- **计算过程**:
  - 基础分: 90分 ≥ 80分 → 20 SP
  - 额外分: 300分钟 ÷ 30分钟 = 10个30分钟 → 10 × 5 = 50 SP，但最多30 SP
  - 总积分: 20 + 30 = 50 SP
- **最终积分**: 50 SP

### 示例5：每日上限
- **睡眠评分**: 100分
- **深睡时长**: 360分钟（6小时）
- **计算过程**:
  - 基础分: 100分 ≥ 80分 → 20 SP
  - 额外分: 360分钟 ÷ 30分钟 = 12个30分钟 → 12 × 5 = 60 SP，但最多30 SP
  - 总积分: 20 + 30 = 50 SP，但每日上限50 SP
- **最终积分**: 50 SP

## 边界值测试

### 睡眠评分边界值
- 80分 → 20 SP（≥80分区间）
- 79分 → 15 SP（70-79分区间）
- 70分 → 15 SP（70-79分区间）
- 69分 → 10 SP（60-69分区间）
- 60分 → 10 SP（60-69分区间）
- 59分 → 5 SP（<60分区间）

### 深睡时长边界值
- 29分钟 → 0 SP（不足30分钟）
- 30分钟 → 5 SP（1个30分钟）
- 59分钟 → 5 SP（1个30分钟）
- 60分钟 → 10 SP（2个30分钟）
- 90分钟 → 15 SP（3个30分钟）
- 180分钟 → 30 SP（6个30分钟，达到上限）

## API调用示例

### 生成积分
```bash
curl -X POST "http://localhost:8080/api/points/generate?userId=user001&dateOfSleep=2024-01-01"
```

### 查询积分历史
```bash
curl -X GET "http://localhost:8080/api/points/history?userId=user001"
```

### 查询当前总积分
```bash
curl -X GET "http://localhost:8080/api/points/current?userId=user001"
```

## 注意事项

1. 积分计算基于睡眠数据表中的数据
2. 必须先有睡眠数据才能生成积分
3. 同一天只能生成一次积分
4. 积分计算具有事务性，确保数据一致性
5. 支持异常值处理，确保系统稳定性
