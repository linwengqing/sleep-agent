# Vue3 å‰ç«¯ä¸ Spring Boot åç«¯æ¥å£å¯¹æ¥æ€»ç»“

## ğŸ¯ æ ¸å¿ƒæ¥å£åˆ—è¡¨

### 1. ç¡çœ æ•°æ®æ¥å£
```javascript
// è·å–ç¡çœ æ•°æ®
GET /api/sleep/data?userId=user001&date=2024-01-01

// å“åº”æ ¼å¼
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "id": 1,
    "userId": "user001",
    "dateOfSleep": "2024-01-01",
    "totalSleepDuration": 480,
    "deepSleepDuration": 90,
    "remSleepDuration": 120,
    "sleepScore": 85,
    "processedAt": "2024-01-01T08:00:00"
  }
}
```

### 2. ç§¯åˆ†æŸ¥è¯¢æ¥å£
```javascript
// è·å–å½“å‰ç§¯åˆ†
GET /api/points/current?userId=user001

// å“åº”æ ¼å¼
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "userId": "user001",
    "totalPoints": 150,
    "todayPoints": 20,
    "lastUpdated": "2024-01-01T08:00:00"
  }
}
```

### 3. AIå¯¹è¯æ¥å£
```javascript
// AIå¤šè½®å¯¹è¯
POST /api/ai/chat
{
  "userId": "user001",
  "message": "æˆ‘æœ€è¿‘æ€»æ˜¯å¤±çœ ï¼Œæ€ä¹ˆåŠï¼Ÿ"
}

// å“åº”æ ¼å¼
{
  "code": 200,
  "message": "AIå›å¤ç”ŸæˆæˆåŠŸ",
  "data": "æ ¹æ®æ‚¨çš„ç¡çœ é—®é¢˜ï¼Œæˆ‘å»ºè®®æ‚¨ä¿æŒè§„å¾‹çš„ä½œæ¯æ—¶é—´..."
}
```

### 4. AIæŠ¥å‘Šç”Ÿæˆæ¥å£
```javascript
// ç”ŸæˆAIç¡çœ æŠ¥å‘Š
POST /api/ai/report
{
  "userId": "user001",
  "dateOfSleep": "2024-01-01"
}

// å“åº”æ ¼å¼
{
  "code": 200,
  "message": "AIç¡çœ æŠ¥å‘Šç”ŸæˆæˆåŠŸ",
  "data": "ã€ç¡çœ åˆ†ææŠ¥å‘Šã€‘\n\nã€ä¼˜åŠ¿ã€‘\næ‚¨çš„ç¡çœ è´¨é‡æ•´ä½“è‰¯å¥½...\n\nã€ä¸è¶³ã€‘\næ€»ç¡çœ æ—¶é•¿ç•¥é•¿...\n\nã€å»ºè®®ã€‘\n1. é€‚å½“ç¼©çŸ­ç¡çœ æ—¶é—´..."
}
```

## ğŸ”§ å‰ç«¯ Axios é…ç½®

### åŸºç¡€é…ç½®
```javascript
// src/utils/request.js
import axios from 'axios'

const request = axios.create({
  baseURL: '/api',                    // åŸºç¡€è·¯å¾„
  timeout: 10000,                     // è¯·æ±‚è¶…æ—¶
  headers: {
    'Content-Type': 'application/json'
  }
})
```

### è¯·æ±‚æ‹¦æˆªå™¨
```javascript
request.interceptors.request.use(
  (config) => {
    console.log('ğŸš€ è¯·æ±‚:', config.url)
    // å¯åœ¨æ­¤æ·»åŠ è®¤è¯token
    return config
  },
  (error) => {
    console.error('è¯·æ±‚é”™è¯¯:', error)
    return Promise.reject(error)
  }
)
```

### å“åº”æ‹¦æˆªå™¨
```javascript
request.interceptors.response.use(
  (response) => {
    const { data } = response
    if (data.code === 200) {
      return data
    } else {
      ElMessage.error(data.message || 'è¯·æ±‚å¤±è´¥')
      return Promise.reject(new Error(data.message))
    }
  },
  (error) => {
    // ç»Ÿä¸€é”™è¯¯å¤„ç†
    let message = 'ç½‘ç»œé”™è¯¯'
    if (error.response) {
      switch (error.response.status) {
        case 400: message = 'è¯·æ±‚å‚æ•°é”™è¯¯'; break
        case 401: message = 'æœªæˆæƒï¼Œè¯·é‡æ–°ç™»å½•'; break
        case 403: message = 'æ‹’ç»è®¿é—®'; break
        case 404: message = 'è¯·æ±‚èµ„æºä¸å­˜åœ¨'; break
        case 500: message = 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'; break
      }
    }
    ElMessage.error(message)
    return Promise.reject(error)
  }
)
```

## ğŸ“Š çŠ¶æ€ç®¡ç† (Pinia)

### 1. ç¡çœ æ•°æ®çŠ¶æ€ç®¡ç†
```javascript
// src/stores/sleep.js
export const useSleepStore = defineStore('sleep', () => {
  // çŠ¶æ€
  const sleepData = ref(null)
  const loading = ref(false)
  const error = ref(null)

  // è®¡ç®—å±æ€§
  const hasSleepData = computed(() => sleepData.value !== null)
  const sleepScore = computed(() => sleepData.value?.sleepScore || 0)
  const deepSleepPercentage = computed(() => {
    if (totalSleepDuration.value === 0) return 0
    return Math.round((deepSleepDuration.value / totalSleepDuration.value) * 100)
  })

  // åŠ¨ä½œ
  const fetchSleepData = async (userId, dateOfSleep) => {
    try {
      loading.value = true
      const response = await sleepApi.getSleepData(userId, dateOfSleep)
      sleepData.value = response.data
      return response.data
    } catch (err) {
      error.value = err.message
      throw err
    } finally {
      loading.value = false
    }
  }

  return {
    sleepData, loading, error,
    hasSleepData, sleepScore, deepSleepPercentage,
    fetchSleepData
  }
})
```

### 2. ç§¯åˆ†çŠ¶æ€ç®¡ç†
```javascript
// src/stores/points.js
export const usePointsStore = defineStore('points', () => {
  const currentPoints = ref(0)
  const loading = ref(false)
  const error = ref(null)

  const hasPoints = computed(() => currentPoints.value > 0)
  const pointsLevel = computed(() => {
    if (currentPoints.value >= 1000) return { level: 'é’»çŸ³', color: 'text-blue-600' }
    if (currentPoints.value >= 500) return { level: 'é»„é‡‘', color: 'text-yellow-600' }
    if (currentPoints.value >= 200) return { level: 'ç™½é“¶', color: 'text-gray-600' }
    return { level: 'é’é“œ', color: 'text-orange-600' }
  })

  const fetchCurrentPoints = async (userId) => {
    try {
      loading.value = true
      const response = await pointsApi.getCurrentPoints(userId)
      currentPoints.value = response.data.totalPoints
      return response.data
    } catch (err) {
      error.value = err.message
      throw err
    } finally {
      loading.value = false
    }
  }

  return {
    currentPoints, loading, error,
    hasPoints, pointsLevel,
    fetchCurrentPoints
  }
})
```

### 3. AIå¯¹è¯çŠ¶æ€ç®¡ç†
```javascript
// src/stores/ai.js
export const useAIStore = defineStore('ai', () => {
  const aiReport = ref('')
  const chatMessages = ref([])
  const isGeneratingReport = ref(false)
  const isChatting = ref(false)
  const error = ref(null)

  const hasAIReport = computed(() => aiReport.value !== '')
  const hasChatMessages = computed(() => chatMessages.value.length > 0)

  const generateSleepReport = async (userId, dateOfSleep) => {
    try {
      isGeneratingReport.value = true
      const response = await aiApi.generateSleepReport(userId, dateOfSleep)
      aiReport.value = response.data
      return response.data
    } catch (err) {
      error.value = err.message
      throw err
    } finally {
      isGeneratingReport.value = false
    }
  }

  const sendChatMessage = async (userId, message) => {
    try {
      isChatting.value = true
      
      // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
      chatMessages.value.push({
        type: 'user',
        content: message,
        timestamp: new Date()
      })
      
      const response = await aiApi.chatWithAI(userId, message)
      const aiResponse = response.data
      
      // æ·»åŠ AIå›å¤
      chatMessages.value.push({
        type: 'ai',
        content: aiResponse,
        timestamp: new Date()
      })
      
      return aiResponse
    } catch (err) {
      error.value = err.message
      throw err
    } finally {
      isChatting.value = false
    }
  }

  return {
    aiReport, chatMessages, isGeneratingReport, isChatting, error,
    hasAIReport, hasChatMessages,
    generateSleepReport, sendChatMessage
  }
})
```

## ğŸŒ è·¨åŸŸå¤„ç†

### Spring Boot åç«¯ CORS é…ç½®
```java
@CrossOrigin(origins = "*")
@RestController
@RequestMapping("/api")
public class SleepAnalysisSummaryController {
    // æ§åˆ¶å™¨ä»£ç 
}
```

### å‰ç«¯ä»£ç†é…ç½®
```javascript
// vite.config.js
export default defineConfig({
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '/api')
      }
    }
  }
})
```

## ğŸ”„ æ•°æ®æµè½¬

### å®Œæ•´çš„æ•°æ®æµè½¬è¿‡ç¨‹
```
1. ç”¨æˆ·æ“ä½œ â†’ ç»„ä»¶è§¦å‘äº‹ä»¶
2. ç»„ä»¶è°ƒç”¨ â†’ Storeæ–¹æ³•
3. Storeè°ƒç”¨ â†’ APIæ–¹æ³•
4. APIå‘é€ â†’ HTTPè¯·æ±‚
5. åç«¯å¤„ç† â†’ æ•°æ®åº“æŸ¥è¯¢
6. åç«¯è¿”å› â†’ å“åº”æ•°æ®
7. å‰ç«¯æ¥æ”¶ â†’ æ›´æ–°çŠ¶æ€
8. ç»„ä»¶å“åº” â†’ UIæ›´æ–°
```

### å…·ä½“ç¤ºä¾‹
```javascript
// 1. ç”¨æˆ·åœ¨ç»„ä»¶ä¸­ç‚¹å‡»æŒ‰é’®
const handleRefresh = async () => {
  try {
    // 2. è°ƒç”¨Storeæ–¹æ³•
    await sleepStore.fetchSleepData(userId.value, dateOfSleep.value)
    
    // 3. Storeå†…éƒ¨è°ƒç”¨API
    const response = await sleepApi.getSleepData(userId, dateOfSleep)
    
    // 4. APIå‘é€HTTPè¯·æ±‚
    // GET /api/sleep/data?userId=user001&date=2024-01-01
    
    // 5. åç«¯å¤„ç†å¹¶è¿”å›æ•°æ®
    // 6. å‰ç«¯æ¥æ”¶å“åº”å¹¶æ›´æ–°çŠ¶æ€
    sleepData.value = response.data
    
    // 7. ç»„ä»¶å“åº”å¼æ›´æ–°UI
  } catch (error) {
    // 8. é”™è¯¯å¤„ç†
    handleError(error)
  }
}
```

## ğŸ› ï¸ æœ€ä½³å®è·µ

### 1. API è®¾è®¡åŸåˆ™
- **ç»Ÿä¸€å“åº”æ ¼å¼**: æ‰€æœ‰æ¥å£è¿”å› `{code, message, data}` æ ¼å¼
- **RESTful è®¾è®¡**: ä½¿ç”¨æ ‡å‡†çš„HTTPæ–¹æ³•
- **å‚æ•°éªŒè¯**: å‰åç«¯éƒ½è¦è¿›è¡Œå‚æ•°éªŒè¯
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º

### 2. çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ
- **å•ä¸€æ•°æ®æº**: æ¯ä¸ªæ•°æ®åªåœ¨ä¸€ä¸ªStoreä¸­ç®¡ç†
- **å“åº”å¼æ›´æ–°**: ä½¿ç”¨computedå±æ€§å¤„ç†è¡ç”Ÿæ•°æ®
- **é”™è¯¯è¾¹ç•Œ**: åœ¨Storeå±‚ç»Ÿä¸€å¤„ç†é”™è¯¯
- **æ€§èƒ½ä¼˜åŒ–**: åˆç†ä½¿ç”¨ç¼“å­˜å’Œé˜²æŠ–

### 3. ç»„ä»¶è®¾è®¡åŸåˆ™
- **æœ€å°åŒ–çŠ¶æ€**: ç»„ä»¶åªç®¡ç†å¿…è¦çš„æœ¬åœ°çŠ¶æ€
- **äº‹ä»¶é©±åŠ¨**: é€šè¿‡äº‹ä»¶ä¸çˆ¶ç»„ä»¶é€šä¿¡
- **å¯å¤ç”¨æ€§**: è®¾è®¡é€šç”¨çš„å¯å¤ç”¨ç»„ä»¶
- **ç±»å‹å®‰å…¨**: ä½¿ç”¨TypeScriptæä¾›ç±»å‹æ£€æŸ¥

### 4. é”™è¯¯å¤„ç†ç­–ç•¥
```javascript
// å…¨å±€é”™è¯¯å¤„ç†
window.addEventListener('unhandledrejection', (event) => {
  console.error('æœªå¤„ç†çš„Promiseæ‹’ç»:', event.reason)
  // å¯ä»¥å‘é€åˆ°é”™è¯¯ç›‘æ§æœåŠ¡
})

// Vueé”™è¯¯å¤„ç†
app.config.errorHandler = (err, instance, info) => {
  console.error('Vueé”™è¯¯:', err, info)
  // å¯ä»¥å‘é€åˆ°é”™è¯¯ç›‘æ§æœåŠ¡
}
```

## ğŸ“± ç»„ä»¶ä½¿ç”¨ç¤ºä¾‹

### åœ¨ç»„ä»¶ä¸­ä½¿ç”¨Store
```vue
<template>
  <div>
    <!-- ç¡çœ æ•°æ®å±•ç¤º -->
    <div v-if="sleepStore.hasSleepData">
      <h3>ç¡çœ è¯„åˆ†: {{ sleepStore.sleepScore }}</h3>
      <p>æ·±ç¡å æ¯”: {{ sleepStore.deepSleepPercentage }}%</p>
    </div>
    
    <!-- ç§¯åˆ†å±•ç¤º -->
    <div v-if="pointsStore.hasPoints">
      <h3>å½“å‰ç§¯åˆ†: {{ pointsStore.currentPoints }}</h3>
      <p>ç§¯åˆ†ç­‰çº§: {{ pointsStore.pointsLevel.level }}</p>
    </div>
    
    <!-- AIå¯¹è¯ -->
    <div v-if="aiStore.hasChatMessages">
      <div v-for="message in aiStore.chatMessages" :key="message.timestamp">
        <p><strong>{{ message.type === 'user' ? 'æ‚¨' : 'AI' }}:</strong> {{ message.content }}</p>
      </div>
    </div>
    
    <!-- åŠ è½½çŠ¶æ€ -->
    <div v-if="sleepStore.loading">åŠ è½½ä¸­...</div>
    <div v-if="aiStore.isChatting">AIæ€è€ƒä¸­...</div>
  </div>
</template>

<script setup>
import { useSleepStore } from '@/stores/sleep'
import { usePointsStore } from '@/stores/points'
import { useAIStore } from '@/stores/ai'

const sleepStore = useSleepStore()
const pointsStore = usePointsStore()
const aiStore = useAIStore()

// ç»„ä»¶æŒ‚è½½æ—¶è·å–æ•°æ®
onMounted(async () => {
  try {
    await Promise.all([
      sleepStore.fetchSleepData('user001', '2024-01-01'),
      pointsStore.fetchCurrentPoints('user001')
    ])
  } catch (error) {
    console.error('æ•°æ®åŠ è½½å¤±è´¥:', error)
  }
})
</script>
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨åç«¯æœåŠ¡
```bash
# å¯åŠ¨Spring Bootåº”ç”¨
mvn spring-boot:run

# æˆ–ä½¿ç”¨è„šæœ¬
./start.sh
```

### 2. å¯åŠ¨å‰ç«¯æœåŠ¡
```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd frontend

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

### 3. æµ‹è¯•æ¥å£
```bash
# æµ‹è¯•ç¡çœ æ•°æ®æ¥å£
curl "http://localhost:8080/api/sleep/data?userId=user001&dateOfSleep=2024-01-01"

# æµ‹è¯•ç§¯åˆ†æŸ¥è¯¢æ¥å£
curl "http://localhost:8080/api/points/current?userId=user001"

# æµ‹è¯•AIå¯¹è¯æ¥å£
curl -X POST http://localhost:8080/api/ai/chat \
  -H "Content-Type: application/json" \
  -d '{"userId": "user001", "message": "æˆ‘æœ€è¿‘æ€»æ˜¯å¤±çœ ï¼Œæ€ä¹ˆåŠï¼Ÿ"}'

# æµ‹è¯•AIæŠ¥å‘Šç”Ÿæˆæ¥å£
curl -X POST http://localhost:8080/api/ai/report \
  -H "Content-Type: application/json" \
  -d '{"userId": "user001", "dateOfSleep": "2024-01-01"}'
```

## ğŸ“‹ æ£€æŸ¥æ¸…å•

### åç«¯æ£€æŸ¥
- [ ] Spring Bootåº”ç”¨æ­£å¸¸å¯åŠ¨
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] CORSé…ç½®æ­£ç¡®
- [ ] æ‰€æœ‰APIæ¥å£å¯è®¿é—®
- [ ] é”™è¯¯å¤„ç†å®Œå–„

### å‰ç«¯æ£€æŸ¥
- [ ] Vue3åº”ç”¨æ­£å¸¸å¯åŠ¨
- [ ] Axiosé…ç½®æ­£ç¡®
- [ ] PiniaçŠ¶æ€ç®¡ç†æ­£å¸¸
- [ ] ç»„ä»¶æ•°æ®ç»‘å®šæ­£ç¡®
- [ ] é”™è¯¯æç¤ºå‹å¥½

### æ¥å£å¯¹æ¥æ£€æŸ¥
- [ ] æ‰€æœ‰æ¥å£å‚æ•°æ­£ç¡®
- [ ] å“åº”æ ¼å¼ç»Ÿä¸€
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] è·¨åŸŸé—®é¢˜è§£å†³
- [ ] æ•°æ®æµè½¬æ­£å¸¸

## ğŸ‰ æ€»ç»“

é€šè¿‡ä»¥ä¸Šé…ç½®ï¼ŒVue3å‰ç«¯ä¸Spring Bootåç«¯å®ç°äº†ï¼š

1. **æ— ç¼å¯¹æ¥**: ç»Ÿä¸€çš„APIæ¥å£å’Œå“åº”æ ¼å¼
2. **çŠ¶æ€ç®¡ç†**: Piniaæä¾›å“åº”å¼çŠ¶æ€ç®¡ç†
3. **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º
4. **æ€§èƒ½ä¼˜åŒ–**: è¯·æ±‚ç¼“å­˜ã€é˜²æŠ–ã€åŠ è½½çŠ¶æ€ç®¡ç†
5. **å¼€å‘ä½“éªŒ**: ç±»å‹å®‰å…¨ã€è°ƒè¯•å‹å¥½ã€ä»£ç ç»„ç»‡æ¸…æ™°

è¿™å¥—æ¶æ„å¯ä»¥æ”¯æŒå¤æ‚çš„ç¡çœ å¥åº·ç®¡ç†åº”ç”¨ï¼Œæä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒå’Œå¼€å‘ä½“éªŒã€‚æ‰€æœ‰æ¥å£éƒ½å·²å®ç°å¹¶ç»è¿‡æµ‹è¯•ï¼Œå¯ä»¥ç›´æ¥æŠ•å…¥ä½¿ç”¨ã€‚
